"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9592],{5352:(D,R,s)=>{s.d(R,{S:()=>e});var m=s(177),u=s(4341),i=s(4742),d=s(4438);let e=(()=>{var a;class M{}return(a=M).\u0275fac=function(g){return new(g||a)},a.\u0275mod=d.$C({type:a}),a.\u0275inj=d.G2t({imports:[m.MD,u.YN,i.bv]}),M})()},7905:(D,R,s)=>{s.d(R,{V:()=>l});var m=s(467),u=s(9853),i=s(4262),d=s(3114),e=s(4438),a=s(4742),M=s(1182),k=s(4354),g=s(177),C=s(4341);function f(c,_){if(1&c&&(e.j41(0,"ion-select-option",9),e.EFF(1),e.k0s()),2&c){const h=_.$implicit;e.Y8G("value",h),e.R7$(),e.JRh(h)}}function r(c,_){if(1&c&&e.nrm(0,"ion-img",10),2&c){const h=e.XpG();e.Y8G("src",h.selectedImage)}}let l=(()=>{var c;class _{constructor(n,o,p,t){this.modalController=n,this.firestore=o,this.afAuth=p,this.categoriaService=t,this.selectedImage=null,this.recipe={titulo:"",descripcion:"",ingredientes:"",instrucciones:"",minutos:"",imagenUrl:"",categoria:""},this.categorias=[],this.selectedFile=null,this.afAuth.authState.subscribe(E=>{E&&(this.currentUser=E,console.log("Usuario autenticado:",this.currentUser))})}ngOnInit(){this.getCategories(),this.customOptions={header:"Selecciona una Categor\xeda",buttons:[{text:"Cerrar",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Seleccionado Cancelar")}},{text:"Seleccionar",handler:n=>{console.log("Categor\xeda seleccionada:",n)}}]}}procesarInstrucciones(){if(this.recipe.instrucciones){let o=this.recipe.instrucciones.split("\n").map((p,t)=>""!==p.trim()?`${t+1}. ${p.trim()}`:"");this.recipe.instrucciones=o.filter(Boolean).join("\n")}}getCategories(){this.categoriaService.getCategorias().subscribe(n=>{this.categorias=n.categorias,console.log(this.categorias)},n=>{console.error("Error al obtener las categor\xedas:",n)})}dismiss(){this.modalController.dismiss({dismissed:!0})}selectImage(){var n=this;return(0,m.A)(function*(){console.log("seleccionando foto...");const o=yield d.i7.getPhoto({quality:90,allowEditing:!1,resultType:d.LK.DataUrl,source:d.ru.Prompt});n.selectedImage=o.dataUrl})()}onFileSelected(n){const o=n.target;o.files&&o.files.length>0&&(this.selectedFile=o.files[0])}uploadImage(n){var o=this;return(0,m.A)(function*(){const p=(0,u.c7)(),t=`${o.currentUser.uid}-${Date.now()}-${n.name}`,E=(0,u.KR)(p,`recipe-images/${t}`);return yield(0,u.D)(E,n),yield(0,u.qk)(E)})()}saveRecipe(){var n=this;return(0,m.A)(function*(){if(console.log("Save Recipe button clicked"),n.selectedFile&&n.currentUser)try{console.log("Selected file:",n.selectedFile),n.procesarInstrucciones(),n.recipe.imagenUrl=yield n.uploadImage(n.selectedFile),console.log("Image uploaded successfully:",n.recipe.imagenUrl);const o=(0,i.H9)(n.firestore,`users/${n.currentUser.uid}`),I=((yield(0,i.x7)(o)).data(),(0,i.rJ)(n.firestore,"recetas"));yield(0,i.gS)(I,{categoria:n.recipe.categoria,titulo:n.recipe.titulo,descripcion:n.recipe.descripcion,ingredientes:n.recipe.ingredientes,instrucciones:n.recipe.instrucciones,minutos:Number(n.recipe.minutos),imagen:n.recipe.imagenUrl,autorId:n.currentUser.uid}),console.log("Receta agregada exitosamente"),n.dismiss()}catch(o){console.error("Error al agregar receta:",o)}else console.error("No se seleccion\xf3 ninguna imagen o no se ha autenticado el usuario")})()}}return(c=_).\u0275fac=function(n){return new(n||c)(e.rXU(a.W3),e.rXU(i._7),e.rXU(M.DS),e.rXU(k.v))},c.\u0275cmp=e.VBU({type:c,selectors:[["app-new-recipe-modal"]],decls:42,vars:9,consts:[["slot","end"],[3,"click"],["position","stacked"],["interface","alert","placeholder","Seleccionar...",3,"ngModelChange","ngModel","interfaceOptions"],[3,"value",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"],["type","number",3,"ngModelChange","ngModel"],["expand","block",3,"click"],[3,"src",4,"ngIf"],[3,"value"],[3,"src"]],template:function(n,o){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Nueva Receta"),e.k0s(),e.j41(4,"ion-buttons",0)(5,"ion-button",1),e.bIt("click",function(){return o.dismiss()}),e.EFF(6,"X"),e.k0s()()()(),e.j41(7,"ion-content")(8,"ion-list")(9,"ion-item")(10,"ion-label",2),e.EFF(11,"Categor\xeda"),e.k0s(),e.j41(12,"ion-select",3),e.mxI("ngModelChange",function(t){return e.DH7(o.recipe.categoria,t)||(o.recipe.categoria=t),t}),e.DNE(13,f,2,2,"ion-select-option",4),e.k0s()(),e.j41(14,"ion-item")(15,"ion-label",2),e.EFF(16,"T\xedtulo"),e.k0s(),e.j41(17,"ion-input",5),e.mxI("ngModelChange",function(t){return e.DH7(o.recipe.titulo,t)||(o.recipe.titulo=t),t}),e.k0s()(),e.j41(18,"ion-item")(19,"ion-label",2),e.EFF(20,"Descripci\xf3n"),e.k0s(),e.j41(21,"ion-textarea",5),e.mxI("ngModelChange",function(t){return e.DH7(o.recipe.descripcion,t)||(o.recipe.descripcion=t),t}),e.k0s()(),e.j41(22,"ion-item")(23,"ion-label",2),e.EFF(24,"Ingredientes"),e.k0s(),e.j41(25,"ion-textarea",5),e.mxI("ngModelChange",function(t){return e.DH7(o.recipe.ingredientes,t)||(o.recipe.ingredientes=t),t}),e.k0s()(),e.j41(26,"ion-item")(27,"ion-label",2),e.EFF(28,"Instrucciones"),e.k0s(),e.j41(29,"ion-textarea",5),e.mxI("ngModelChange",function(t){return e.DH7(o.recipe.instrucciones,t)||(o.recipe.instrucciones=t),t}),e.k0s()(),e.j41(30,"ion-item")(31,"ion-label",2),e.EFF(32,"Tiempo en minutos"),e.k0s(),e.j41(33,"ion-input",6),e.mxI("ngModelChange",function(t){return e.DH7(o.recipe.minutos,t)||(o.recipe.minutos=t),t}),e.k0s()(),e.j41(34,"ion-item")(35,"ion-label",2),e.EFF(36,"Imagen"),e.k0s(),e.j41(37,"ion-button",7),e.bIt("click",function(){return o.selectImage()}),e.EFF(38,"Seleccionar imagen"),e.k0s()(),e.DNE(39,r,1,1,"ion-img",8),e.k0s(),e.j41(40,"ion-button",7),e.bIt("click",function(){return o.saveRecipe()}),e.EFF(41,"Publicar Receta"),e.k0s()()),2&n&&(e.R7$(12),e.R50("ngModel",o.recipe.categoria),e.Y8G("interfaceOptions",o.customOptions),e.R7$(),e.Y8G("ngForOf",o.categorias),e.R7$(4),e.R50("ngModel",o.recipe.titulo),e.R7$(4),e.R50("ngModel",o.recipe.descripcion),e.R7$(4),e.R50("ngModel",o.recipe.ingredientes),e.R7$(4),e.R50("ngModel",o.recipe.instrucciones),e.R7$(4),e.R50("ngModel",o.recipe.minutos),e.R7$(6),e.Y8G("ngIf",o.selectedImage))},dependencies:[g.Sq,g.bT,a.Jm,a.QW,a.W9,a.eU,a.KW,a.$w,a.uz,a.he,a.nf,a.Nm,a.Ip,a.nc,a.BC,a.ai,a.su,a.Je,a.Gw,C.BC,C.vS]}),_})()},1785:(D,R,s)=>{s.d(R,{G:()=>k});var m=s(467),u=s(4262),i=s(4438),d=s(4742),e=s(1182),a=s(177);function M(g,C){if(1&g&&(i.j41(0,"li"),i.nrm(1,"ion-icon",15),i.EFF(2),i.k0s()),2&g){const f=C.$implicit;i.R7$(2),i.SpI(" ",f," ")}}let k=(()=>{var g;class C{constructor(r,l,c){this.modalController=r,this.firestore=l,this.afAuth=c,this.authorName="Cargando...",this.isLiked=!1,this.likeCount=0,this.afAuth.authState.subscribe(_=>{_&&(this.currentUser=_,this.checkIfLiked(),this.getLikeCount())})}ngOnInit(){this.loadAuthorName()}loadAuthorName(){var r=this;return(0,m.A)(function*(){if(console.log(r.receta.autorId),r.receta&&r.receta.autorId){const l=(0,u.H9)(r.firestore,`users/${r.receta.autorId}`),c=yield(0,u.x7)(l);if(c.exists()){const _=c.data();r.authorName=`${null==_?void 0:_.firstName} ${null==_?void 0:_.lastName}`,console.log(r.authorName)}else r.authorName="Autor desconocido"}else r.authorName="Autor desconocido"})()}dismiss(){this.modalController.dismiss()}toggleLike(){if(!this.currentUser)return void console.log("El usuario no est\xe1 autenticado.");const r=this.receta.id,l=this.currentUser.uid,c=(0,u.H9)(this.firestore,`likes/${r}_${l}`);this.isLiked=!this.isLiked,this.likeCount+=this.isLiked?1:-1,this.isLiked?(0,u.BN)(c,{postID:r,userID:l}).then(()=>{console.log("Like a\xf1adido en Firebase.")}).catch(_=>{console.log("Error al a\xf1adir like:",_),this.isLiked=!1,this.likeCount--}):(0,u.kd)(c).then(()=>{console.log("Like eliminado en Firebase.")}).catch(_=>{console.log("Error al eliminar like:",_),this.isLiked=!0,this.likeCount++})}checkIfLiked(){var r=this;return(0,m.A)(function*(){if(!r.currentUser)return;const _=(0,u.H9)(r.firestore,`likes/${r.receta.id}_${r.currentUser.uid}`),h=yield(0,u.x7)(_);r.isLiked=h.exists()})()}getLikeCount(){var r=this;return(0,m.A)(function*(){const l=(0,u.rJ)(r.firestore,"likes"),c=(0,u.P)(l,(0,u._M)("postID","==",r.receta.id)),_=yield(0,u.GG)(c);r.likeCount=_.size})()}}return(g=C).\u0275fac=function(r){return new(r||g)(i.rXU(d.W3),i.rXU(u._7),i.rXU(e.DS))},g.\u0275cmp=i.VBU({type:g,selectors:[["app-recipe-detail-modal"]],inputs:{receta:"receta"},decls:38,vars:8,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],[1,"animate__animated","animate__slideInUp"],[1,"recipe-image",3,"src"],[1,"like-icon",3,"click","name"],[1,"recipe-title"],[1,"recipe-meta-container"],[1,"recipe-author"],["src","https://ionicframework.com/docs/demos/api/avatar/avatar.svg"],[1,"recipe-likes"],["name","heart"],[1,"divider"],[4,"ngFor","ngForOf"],[2,"white-space","pre-wrap",3,"innerHTML"],["name","checkmark-circle"]],template:function(r,l){1&r&&(i.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),i.bIt("click",function(){return l.dismiss()}),i.nrm(4,"ion-icon",2),i.k0s()()()(),i.j41(5,"ion-content")(6,"ion-card",3)(7,"ion-card-header")(8,"ion-card-title"),i.nrm(9,"ion-img",4),i.j41(10,"ion-icon",5),i.bIt("click",function(){return l.toggleLike()}),i.k0s()()(),i.j41(11,"ion-card-content")(12,"h2",6),i.EFF(13),i.k0s(),i.j41(14,"div",7)(15,"div",8)(16,"ion-avatar"),i.nrm(17,"img",9),i.k0s(),i.j41(18,"span"),i.EFF(19),i.k0s()(),i.j41(20,"div",10),i.nrm(21,"ion-icon",11),i.j41(22,"span"),i.EFF(23),i.k0s()()(),i.nrm(24,"hr",12),i.j41(25,"h3"),i.EFF(26,"Descripcion"),i.k0s(),i.j41(27,"p"),i.EFF(28),i.k0s(),i.nrm(29,"hr",12),i.j41(30,"h3"),i.EFF(31,"Ingredientes"),i.k0s(),i.j41(32,"ul"),i.DNE(33,M,3,1,"li",13),i.k0s(),i.nrm(34,"hr",12),i.j41(35,"h3"),i.EFF(36,"Instrucciones"),i.k0s(),i.nrm(37,"div",14),i.k0s()()()),2&r&&(i.R7$(9),i.Y8G("src",l.receta.imagen),i.R7$(),i.Y8G("name",l.isLiked?"heart":"heart-outline"),i.R7$(3),i.JRh(l.receta.titulo),i.R7$(6),i.JRh(l.authorName),i.R7$(4),i.SpI("",l.likeCount," Likes"),i.R7$(5),i.JRh(l.receta.descripcion),i.R7$(5),i.Y8G("ngForOf",l.receta.ingredientes.split("\n")),i.R7$(4),i.Y8G("innerHTML",l.receta.instrucciones,i.npT))},dependencies:[a.Sq,d.mC,d.Jm,d.QW,d.b_,d.I9,d.ME,d.tN,d.W9,d.eU,d.iq,d.KW,d.ai],styles:['@charset "UTF-8";.recipe-image[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover;border-radius:0 0 20px 20px}.recipe-details-container[_ngcontent-%COMP%]{padding:16px;background-color:#1a1a1a;border-top-left-radius:20px;border-top-right-radius:20px;margin-top:-20px;box-shadow:0 -2px 10px #0000001a}.recipe-title[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:8px}.recipe-meta-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}.recipe-author[_ngcontent-%COMP%]{display:flex;align-items:center}.recipe-author[_ngcontent-%COMP%]   ion-avatar[_ngcontent-%COMP%]{width:32px;height:32px;margin-right:8px}.recipe-likes[_ngcontent-%COMP%]{display:flex;align-items:center}.recipe-likes[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#e74c3c;margin-right:4px}h3[_ngcontent-%COMP%]{margin-top:16px;font-size:18px;font-weight:700}p[_ngcontent-%COMP%]{line-height:1.5;color:#666}ul[_ngcontent-%COMP%]{list-style-type:none;padding-left:0;margin:0}li[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:8px}li[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#28a745;margin-right:8px}.divider[_ngcontent-%COMP%]{border:0;height:1px;background-color:#ddd;margin:16px 0}.like-icon[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px;font-size:36px;color:#fff;opacity:.9;cursor:pointer}']}),C})()}}]);